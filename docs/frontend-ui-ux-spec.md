# Datai 前端 UI/UX 设计规范

更新时间：2026-02-19  
状态：阶段 1 生效（用于 AI 前端生成）

## 1. 项目说明（给设计/生成模型）
Datai 是一个数据分析 AI Agent Web 应用。  
用户上传电子表格后，通过聊天方式提出分析问题，系统流式返回结论，并在“可展开任务状态面板”中展示 AI 的执行过程（例如数据读取、统计摘要、清洗、图表生成）。

本规范目标：让 AI 能直接生成符合当前产品定位的高质量前端，而不是生成通用聊天壳子。

## 2. 设计目标
1. 让用户始终知道系统在做什么（过程可见）。
2. 主流程短路径可达（上传、提问、看图、看结论）。
3. 结果可复核（面板可展开看细节）。
4. 对新用户低门槛，对进阶用户保留细节深度。

## 3. 信息架构

### 3.1 页面结构（阶段 1）
1. `AppShell`
2. `Header`
3. `Main`（左右布局）
4. `ChatPane`（主区域）
5. `TaskPanel`（侧栏，可收起）
6. `Composer`（输入区）

### 3.2 主要区域职责
1. ChatPane：显示用户消息、AI 流式回答、图表卡片、简版报告卡片。
2. TaskPanel：显示执行状态（折叠态）与步骤细节（展开态）。
3. Composer：输入问题、上传文件、发送消息。

## 4. 关键交互流

### 4.1 首次进入
1. 空状态文案：说明“上传表格并提问即可开始分析”。
2. 展示 2-3 个示例提问按钮（可点击填充输入框）。

### 4.2 上传并提问
1. 用户上传文件后显示文件卡（名称、大小、sheet 数）。
2. 发送问题后立即出现 AI 消息占位和 TaskPanel 运行状态。
3. AI 流式输出文本；图表和报告片段可分块插入。

### 4.3 查看执行细节
1. 折叠态只显示当前动作短文案和进度感。
2. 点击右侧箭头展开后显示事件列表。
3. 点击单个事件可展开 payload/结果摘要/错误信息。

## 5. 任务状态面板（核心）

### 5.1 折叠态（默认）
显示元素：
1. 状态点/加载动画
2. 一行短文案（例如“正在生成统计摘要”）
3. 已耗时
4. 展开箭头

### 5.2 展开态
显示元素：
1. 阶段分组（读取、理解、清洗、分析、可视化、报告）
2. 事件列表（时间、动作、状态）
3. 事件详情区（日志摘要、输出片段、错误提示）

### 5.3 状态类型
1. `pending`
2. `running`
3. `success`
4. `failed`
5. `skipped`（可选）

颜色建议：
1. `running`：蓝
2. `success`：绿
3. `failed`：红
4. `pending/skipped`：中性灰

## 6. 组件规范（建议命名）
1. `AppHeader`
2. `ChatMessageList`
3. `MessageBubbleUser`
4. `MessageBubbleAssistant`
5. `ChartCard`
6. `ReportCard`
7. `TaskStatusPanel`
8. `TaskEventItem`
9. `TaskEventDetail`
10. `FileUploadButton`
11. `PromptComposer`
12. `ExamplePromptChips`

## 7. UI 视觉规范

### 7.1 视觉方向
偏“专业分析工具”而非娱乐聊天：
1. 背景中性浅色
2. 高信息密度但层级清晰
3. 动效克制，重点突出状态变化

### 7.2 设计 Token（建议）
1. `--bg`: `#f8fafc`
2. `--surface`: `#ffffff`
3. `--text-primary`: `#0f172a`
4. `--text-secondary`: `#475569`
5. `--border`: `#e2e8f0`
6. `--brand`: `#2563eb`
7. `--success`: `#16a34a`
8. `--error`: `#dc2626`

字体建议：
1. 中文优先：`Noto Sans SC`
2. 英文/代码：`JetBrains Mono`（仅代码与日志）

## 8. 响应式规范
1. `>=1200px`：双栏（Chat + TaskPanel）。
2. `768px - 1199px`：TaskPanel 默认收起，抽屉展开。
3. `<768px`：单栏，TaskPanel 以底部抽屉显示。

## 9. 反馈与状态设计
1. 任何网络请求必须有 loading 状态。
2. 任何失败必须有可读错误提示（不展示原始堆栈）。
3. 重试入口必须可见（按钮或链接）。
4. 流式中断时，保留已生成内容并提示“可继续重试”。

## 10. 可访问性（A11y）
1. 对比度满足 WCAG AA。
2. 可键盘操作（Tab 顺序合理，Enter 发送，Shift+Enter 换行）。
3. 关键状态支持 `aria-live`（流式输出、任务状态变化）。
4. 所有图标有可访问标签。

## 11. 前端事件数据契约（必须遵守）
前端渲染 TaskPanel 依赖标准事件对象，不依赖自由文本：

```json
{
  "id": "evt_001",
  "phase": "analysis",
  "action": "run_descriptive_stats",
  "status": "running",
  "started_at": "2026-02-19T12:00:00Z",
  "ended_at": null,
  "detail_ref": "log://session/abc/evt_001",
  "payload": {}
}
```

## 12. AI 前端生成约束（强约束）
1. 不生成 Notebook Cell 交互。
2. 不生成多路由复杂后台模板，优先单页主流程。
3. 不引入重型可视化引擎并行（阶段 1 仅 Plotly 路线）。
4. 不把任务细节直接塞进聊天正文，统一放 TaskPanel。
5. UI 模型生成的文案仅用于展示，不参与主模型推理上下文。

## 13. 文案风格
1. 短句、明确、无夸张承诺。
2. 先状态后动作，例如“正在分析缺失值分布”。
3. 错误文案包含下一步建议，例如“图表生成失败，请重试或切换图表类型”。

## 14. 验收清单（前端）
1. 上传文件、发送问题、流式响应、图表渲染流程可跑通。
2. TaskPanel 折叠/展开交互可用。
3. 事件状态渲染准确，失败态有重试入口。
4. 移动端与桌面端布局均可用。
5. 空状态、加载态、错误态均有完整表现。

## 15. 与其他文档关系
1. 产品边界：`docs/prd.md`
2. 功能细则：`docs/requirements.md`
3. 后端事件与架构：`docs/architecture.md`
4. 技术选型：`docs/tech_stack.md`
