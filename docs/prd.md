# Datai 产品需求文档（PRD）

更新时间：2026-02-19  
状态：当前主 PRD（统一入口）

## 1. 项目是什么
Datai 是一个面向电子表格场景的数据分析 AI Agent Web 应用。  
用户上传 CSV/XLSX 后，通过流式对话提出问题，系统自动完成数据理解、清洗、分析、可视化与简版报告输出，并通过可展开任务状态面板实时展示执行过程。

## 2. 要解决的问题
目标用户通常没有完整的数据分析团队，但有明确的数据判断需求。  
他们的核心痛点是：
1. 数据可分析，但流程复杂、门槛高。
2. 需要结论时常常只能拿到“黑盒答案”，过程不可解释。
3. 图表与报告产出慢，且难复核。

## 3. 产品目标与成功标准

### 3.1 业务目标
1. 让用户在单次会话中完成“上传 -> 提问 -> 获得图表和结论”。
2. 让分析过程可追踪、可解释、可复核。
3. 在阶段 1 先形成可用 MVP，再逐步扩展多文件与 RAG-lite。

### 3.2 产品成功标准（阶段 1）
1. 用户能完成单文件多 sheet 的端到端分析闭环。
2. 输出至少包含：统计摘要、清洗说明、图表结论、下一步建议。
3. 任务状态面板可展开查看关键执行日志与结果片段。
4. 失败可见、错误可读，不发生静默失败。

## 4. 目标用户与场景

### 4.1 目标用户
1. 中小团队业务运营/产品经理/分析师（非重度数据科学团队）。
2. 需要快速看数并做决策的人。

### 4.2 典型场景
1. 用户增长/转化/留存分析。
2. 销售与订单结构分析。
3. 指标异常定位与解释。
4. 周报/月报图表与简版分析结论生成。

## 5. 产品原则
1. 先价值后复杂：先做稳定可用，不做过度工程化。
2. 可解释优先：不仅给结论，还要给过程。
3. 单一路径优先：同类能力先选一个主方案。
4. 主模型与 UI 模型职责隔离，避免上下文污染。

## 6. 范围定义

### 6.1 阶段 1（MVP）
1. 单文件上传（CSV/XLSX），支持多 sheet。
2. 流式 Chat 主交互。
3. 可展开任务状态面板（Task Status Panel）。
4. 自动数据理解、基础清洗、统计分析、图表生成。
5. 输出简版图文报告。
6. 固定后端 `127.0.0.1:8000`，仅 Web 形态。

### 6.2 阶段 2
1. 多文件关联分析。
2. 完整图文报告模板化。
3. RAG-lite（小规模高质量知识片段）。

### 6.3 当前不做
1. Notebook Cell 交互模式。
2. 桌面端套壳（Electron/Tauri）。
3. 动态端口协商与复杂鉴权。
4. 全量 RAG 爬虫与复杂向量检索主流程。

## 7. 功能需求（阶段 1）

### 7.1 会话与输入
1. 创建会话。
2. 上传数据文件。
3. 在聊天输入框中提问并获得流式回复。

### 7.2 执行过程展示
1. 面板折叠态：加载动画 + 状态短文案 + 耗时。
2. 面板展开态：事件日志、步骤结果、错误详情。
3. 支持阶段骨架：读取/理解/清洗/分析/可视化/报告。
4. 阶段内动作动态生成，不固定动作枚举。

### 7.3 分析能力
1. 字段类型识别（数值/类别/时间/文本）。
2. 统计摘要（缺失率、分布、异常概览等）。
3. 清洗策略与理由（缺失值、重复值、异常值）。
4. 根据用户问题产出结论与建议。

### 7.4 可视化与报告
1. 自动图表规划。
2. 图表渲染（阶段 1 统一 Plotly 路线）。
3. 生成简版图文报告。

## 8. 非功能需求
1. 响应体验：聊天输出流式可见，用户可感知系统在工作。
2. 可观测性：关键动作均产出结构化事件。
3. 稳定性：错误可捕获、可提示、可重试。
4. 安全边界：本地 `127.0.0.1` 访问，避免公网暴露。
5. 可维护性：规范文档与沉淀资料分层治理。

## 9. 技术约束与选型
1. 前端：Vite + React + TypeScript + Tailwind CSS。
2. 后端：Python + FastAPI + Uvicorn。
3. 数据层：DuckDB（分析）+ SQLite（会话与系统状态）。
4. 模型接入：LiteLLM（主模型 + UI 模型）。
5. 环境管理：`uv` 为主，`micromamba` 仅兜底。
6. RAG：阶段 1 不启用，仅预留模块与文档。

## 10. 双模型职责边界
1. 主模型：任务理解、分析推理、工具调用、最终结论。
2. UI 模型：仅负责任务面板展示文案与可读标签。
3. 约束：UI 模型输出绝不回灌主模型上下文。
4. UI 模型失败：自动重试，仍失败则占位信息，不中断主流程。

## 11. 评测与验收
阶段 1 评测维度：
1. 相关性
2. 有用性
3. 清晰度
4. 可执行性
5. 动作信息完整性
6. 动作顺序准确性
7. 对象细节准确性

## 12. 里程碑建议
1. M1：会话、上传、流式 Chat、基础事件面板打通。
2. M2：统计摘要、清洗策略与理由、基础图表生成。
3. M3：简版报告、错误处理、验收测试与文档闭环。

## 13. 文档映射
1. UI/UX 细则：`docs/frontend-ui-ux-spec.md`
2. 需求细化：`docs/requirements.md`
3. 架构设计：`docs/architecture.md`
4. 技术选型：`docs/tech_stack.md`
5. 评测方案：`docs/evaluation.md`
6. 决策裁决：`docs/decision.md`
7. RAG 预留：`docs/rag-design.md`
